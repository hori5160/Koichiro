<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>統括ホーム（体験型セキュリティ学習）</title>
  <script src="./assets/logger.js"></script>
  <script src="./シナリオ/シナリオ１/common/scenario_core.js"></script>
  <style>
    /* デザイン定義 */
    :root {
      /* ▼▼▼ 背景色を変更しました ▼▼▼ */
      --main-bg: #e5f0fc; /* 普通の水色（お好みに合わせて #b3e5fc などに変更可能） */
      
      --card-bg: #ffffff;
      --text-main: #424b54;
      --text-sub: #555;
      --btn-start-bg: #fc4444;
      --btn-start-hover: #c62323;
      --btn-admin-bg: #dfe6e9;
      --btn-admin-hover: #b2bec3;
      --btn-admin-text: #2d3436;
    }

    body {
      font-family: "Helvetica Neue", Arial, "Hiragino Kaku Gothic ProN", "Hiragino Sans", Meiryo, sans-serif;
      background: var(--main-bg); /* グラデーションではなく単色指定 */
      margin: 0;
      padding: 0;
      color: var(--text-main);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* ヘッダー */
    header {
      background: rgba(255, 255, 255, 0.9);
      padding: 20px;
      text-align: center;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
      position: sticky;
      top: 0;
      z-index: 100;
    }
    
    header h1 {
      margin: 0;
      font-size: 1.8rem;
      color: var(--text-main);
    }

    header p {
      margin: 5px 0 0;
      font-size: 0.9rem;
      color: var(--text-sub);
    }

    .log-status {
      display: inline-block;
      margin-top: 10px;
      padding: 4px 12px;
      background: #e1f5fe;
      color: #0277bd;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: bold;
    }

    /* メインコンテンツ */
    .container {
      flex: 1;
      width: 90%;
      max-width: 900px;
      margin: 40px auto;
    }

    /* シナリオ一覧のグリッドレイアウト */
    .scenario-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      margin-bottom: 40px;
    }

    /* カードスタイル */
    .card {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 25px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.08); /* 影を少し柔らかくしました */
      display: flex;
      flex-direction: column;
      transition: transform 0.2s;
    }

    .card:hover {
      transform: translateY(-5px);
    }

    .card h2 {
      margin-top: 0;
      font-size: 1.3rem;
      color: var(--text-main);
      border-bottom: 2px solid #f1f2f6;
      padding-bottom: 10px;
      margin-bottom: 15px;
    }

    .card p {
      font-size: 0.95rem;
      color: var(--text-sub);
      line-height: 1.5;
      flex-grow: 1;
      margin-bottom: 20px;
    }

    .badge {
      display: inline-block;
      font-size: 0.75rem;
      padding: 2px 8px;
      border-radius: 4px;
      margin-left: 8px;
      vertical-align: middle;
    }
    .badge.warn { background: #fffdcf; color: #d35400; }
    .badge.info { background: #74b9ff; color: #fff; }

    /* ボタン共通 */
    .btn {
      display: inline-block;
      text-decoration: none;
      text-align: center;
      padding: 12px 20px;
      border-radius: 8px;
      font-weight: bold;
      transition: background 0.3s, transform 0.1s;
      border: none;
      cursor: pointer;
      font-size: 1rem;
      width: 100%;
      box-sizing: border-box;
    }

    .btn:active {
      transform: scale(0.98);
    }

    /* 開始ボタン */
    .btn-start {
      background: var(--btn-start-bg);
      color: rgb(255, 255, 255);
    }
    .btn-start:hover {
      background: var(--btn-start-hover);
    }

    /* 管理用エリア */
    .admin-section {
      background: rgba(255, 255, 255, 0.9);
      border-radius: 12px;
      padding: 20px;
      margin-top: 20px;
    }
    
    .admin-section h3 {
      margin-top: 0;
      font-size: 1.1rem;
    }

    .admin-controls {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    .btn-admin {
      background: var(--btn-admin-bg);
      color: var(--btn-admin-text);
      flex: 1;
      min-width: 120px;
      font-size: 0.9rem;
    }
    .btn-admin:hover {
      background: var(--btn-admin-hover);
    }

    footer {
      text-align: center;
      padding: 20px;
      color: #666; /* 背景が明るくなったので文字色を濃く調整 */
      font-size: 0.85rem;
    }

  </style>
</head>

<header style="position: relative; padding: 20px; background: rgba(255, 255, 255, 0.9); box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
  <div style="text-align: center;">
    <h1 style="margin: 0; font-size: 1.8rem; color: var(--text-main);">実体験型セキュリティ学習</h1>
    <p style="margin: 5px 0 0; font-size: 0.9rem; color: var(--text-sub);">
      ブラウザだけで動く
    </p>
    <!--<div class="log-status">
      <span id="logCount">0</span>件
    </div>-->
  </div>

  <a href="admin.html" title="管理画面" 
     style="position: absolute; right: 30px; top: 50%; transform: translateY(-50%); 
            text-decoration: none; font-size: 2.5rem; line-height: 1; filter: grayscale(1); opacity: 0.7; transition: 0.2s;">
    ⚙️
  </a>
</header>

  <div class="container">
    
    <div class="scenario-grid">

      <div class="card">
        <h2>スミッシング<span class="badge warn">10問</span></h2>
        <p>
          <strong>SMS ✕ フィッシング</strong><br>
          偽のテキスト・メッセージを使い、マルウェアをダウンロードさせたり、パスワードを入力させたりする。
        </p>
        <a id="startSmishing" class="btn btn-start" href="#">▶開始する</a>
      </div>

      <div class="card">
        <h2>メールフィッシング<span class="badge warn">10問</span></h2>
        <p>
          <strong>メールフィッシング体験</strong><br>
          PCのメール受信箱に届く「注文確認」メール。本文のリンク先を確認する習慣を！
        </p>
        <a class="btn btn-start" href="./シナリオ/シナリオ３/order_mail_00.html">✕ 未完成</a>
      </div>

      <div class="card">
        <h2>SNSフィッシング<span class="badge warn">10問</span></h2>
        <p>
          <strong>フィッシング体験</strong><br>
          「お得なクーポン配布中！」「期限間近」などのメッセージに潜む罠を見抜こう。
        </p>
        <a class="btn btn-start" href="./シナリオ/シナリオ２/sms_shop_02.html">✕ 未完成</a>
      </div>

      <div class="card">
  <h2>ポップアップ警告詐欺<span class="badge warn">10問</span></h2>
  <p>
    <strong>偽セキュリティ警告</strong><br>
    ブラウザ閲覧中に突然「ウイルスに感染しました」と表示されたら？正しい脱出方法を学びます。
  </p>
  <a class="btn btn-start" href="./シナリオ/シナリオ４/popup_browser.html">✕ 未完成</a>
</div>

    </div>

  </div>

  <footer>
    © 2026 Security Learning Project
  </footer>

  <script>
    // 画面表示時の初期化処理
    function refreshHome(){
      try{
        const events = JSON.parse(localStorage.getItem("sec_learn_events") || "[]");
        const el = document.getElementById("logCount");
        if(el) el.textContent = events.length;
      } catch(e) {
        console.error("ログ読み込みエラー", e);
      }
    }

    // ログ消去ハンドラ
    function handleClearLogs() {
      if(window.SecLogger) {
        if(confirm("保存されているログを消去しますか？")) {
          SecLogger.clearLogs();
          refreshHome();
          alert('ログを消去しました');
        }
      }
    }

    // 全リセットハンドラ
    function handleResetAll() {
      if(confirm("すべての学習データと設定をリセットしますか？\n(ページが再読み込みされます)")) {
        localStorage.clear();
        location.reload();
      }
    }

    // 実行
    refreshHome();

    // ホーム画面自体の閲覧を記録
    try {
      if (window.SecLogger) {
  SecLogger.setContext({ scenario_id: "home", phase: "menu" });
  SecLogger.log("page_view", "home", { title: document.title });
}

    } catch (e) {
      console.log("Logger not found or error:", e);
    }

    document.getElementById("startSmishing").addEventListener("click", (e) => {
  e.preventDefault();

  // ① 前回の回答を消す（やり直し用）
  QuizState.clear();

  // ② ここで毎回「新しい順番」を作る（シャッフル更新）
  QuizFlow.startNewRun(10, { adaptive: true });

  // ③ シャッフル順の先頭から開始する（ここが超重要）
  const first = (QuizFlow.getOrder()[0] || 1);

  location.href =
    `./シナリオ/シナリオ１/${folderName(first)}/quiz_delivery.html?q=${first}`;
});
  </script>
</body>
</html>